#NoEnv
#SingleInstance Force
SetTitleMatchMode, 2
SendMode, Input
SetBatchLines, -1

; =========================
; CONFIG
; =========================
TargetTitle := "Instagram"

ClipMessages := ["BYE", "HELLO WORLD", "Hello"]

MinDelay := 500        ; normal gap
MaxDelay := 900
PendingThreshold := 2000   ; agar send me itna time lage â†’ pending assume
PauseCheckDelay := 4200    ; pause ke baad recheck time

Running := false
Paused := false
MessageIndex := 1

; =========================

F8::
if (Running)
    return

Running := true
Paused := false

while (Running)
{
    if !WinExist(TargetTitle)
    {
        ToolTip, Instagram window not found
        break
    }

    WinActivate
    WinWaitActive, %TargetTitle%,, 2

    if (Paused)
    {
        ToolTip, Pending detected... waiting
        Sleep, PauseCheckDelay
        Paused := false
        ToolTip
        continue
    }

    msg := ClipMessages[MessageIndex]

    ; Clipboard safe send
    ClipSaved := ClipboardAll
    Clipboard := msg
    Sleep, 50

    startTime := A_TickCount

    SendInput, ^v
    Sleep, 50
    SendInput, {Enter}

    sendTime := A_TickCount - startTime

    Clipboard := ClipSaved

    ; -------------------------
    ; PENDING DETECTION
    ; -------------------------
    if (sendTime > PendingThreshold)
    {
        Paused := true
        continue
    }

    ; Normal delay
    Random, wait, MinDelay, MaxDelay
    Sleep, wait

    MessageIndex++
    if (MessageIndex > ClipMessages.Length())
        MessageIndex := 1

    ; CPU breathing
    Sleep, 100
}
return

F9::
Running := false
Paused := false
ToolTip, Script Stopped
Sleep, 500
ToolTip
return
