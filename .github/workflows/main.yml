#NoEnv
#SingleInstance Force
SetTitleMatchMode, 2
SendMode, Input
SetBatchLines, -1

; =========================
; CONFIG
; =========================
TargetTitle := "Instagram"

ClipMessages := []
ClipMessages.Push("BYE")
ClipMessages.Push("HELLO WORLD")
ClipMessages.Push("Hello")

MinDelay := 500            ; minimum delay (ms)
MaxDelay := 900            ; maximum delay (ms)
PendingThreshold := 2000   ; agar send me itna time laga â†’ pending
PauseCheckDelay := 4200    ; pending ke baad wait

Running := false
Paused := false
MessageIndex := 1
; =========================

; ---------- START ----------
F8::
if (Running)
    return

Running := true
Paused := false

while (Running)
{
    if !WinExist(TargetTitle)
    {
        ToolTip, Instagram window not found
        break
    }

    WinActivate
    WinWaitActive, %TargetTitle%,, 2

    if (Paused)
    {
        ToolTip, Pending detected... waiting
        Sleep, PauseCheckDelay
        Paused := false
        ToolTip
        continue
    }

    msg := ClipMessages[MessageIndex]

    ; ---- Safe clipboard send ----
    ClipSaved := ClipboardAll
    Clipboard := msg
    Sleep, 60

    startTime := A_TickCount

    SendInput, ^v
    Sleep, 70
    SendInput, {Enter}

    sendTime := A_TickCount - startTime

    Clipboard := ClipSaved

    ; ---- Pending detection ----
    if (sendTime > PendingThreshold)
    {
        Paused := true
        continue
    }

    ; ---- Random human delay ----
    Random, wait, MinDelay, MaxDelay
    Sleep, wait

    MessageIndex++
    if (MessageIndex > ClipMessages.Length())
        MessageIndex := 1

    ; CPU breathing
    Sleep, 120
}
return

; ---------- STOP ----------
F9::
Running := false
Paused := false
ToolTip, Script Stopped
Sleep, 800
ToolTip
return
